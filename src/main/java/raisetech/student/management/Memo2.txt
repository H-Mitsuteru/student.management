package raisetech.student.management;

import java.util.HashMap;
import java.util.Map;
import javax.swing.Spring;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/students")

@SpringBootApplication
public class Application {

  public static void main(String[] args) {
    // localhost:8080
    SpringApplication.run(Application.class, args);
  }

// --- スタンダート第6回演習課題 ------------------------------------

  private String name = "hayashi mitsuteru";
  private String age = "37";
// 名前をキー、年齢を値とするMap
    private final Map<String, Integer> students = new HashMap<>();

// 追加 (POST)
    @PostMapping
    public String addStudent (@RequestParam String name,@RequestParam int age, String sai){
      students.put(name, age);
      return "追加しました: " + name + " (" + age + "歳)";
    }

// 全件取得 (GET)
    @GetMapping
//    public Map<String, Integer> getStudents () {
//      return students;
//    }
    public Map<String, String> getStudents() {
      Map<String, String> result = new HashMap<>();
      for (Map.Entry<String, Integer> entry : students.entrySet()) {
        result.put(entry.getKey(), entry.getValue() + "歳"); // +歳は値が全てStringなら可能
      }
      return result;
    }

// 個別取得 (GET)
    @GetMapping("/{name}")
    public String getStudent (@PathVariable String name){
//      return name + " : " + students.getOrDefault(name, -1) + "歳";
//    }
    Integer age = students.get(name);
          if (age == null) {
      return name + " は登録されていません";
    }
          return name + " : " + age + "歳";
  }

  @PostMapping("/json")
  // @RequestBodyは、ターミナル入力方法がjson形式  "{\"name\":\"Suzuki\",\"age\":40}"
  // 区切り方はcmd.exeは \"　PowerShellは "　GitBashは ”　改行も＾　‘(shift＋＠)　\ で違う
  public String addStudentJson(@RequestBody Map<String, Object> request) {
    String name = (String) request.get("name");
    int age = (int) request.get("age");
    students.put(name, age);
    return "追加しました: " + name + " (" + age + "歳)";

    }
  }
}
